PKSC#7 схема взаимодействия
===========================

Если для взаимодействия с нами вы выбрали схему pksc7. При такой схеме мы отправляем вам запросы checkOrder и Aviso в зашифрованном виде.
You chose  pksc7 type of encryption for interaction with our system. In this scenario, we send you checkOrder and Aviso requests encrypted.

Возьмите из архива ключ pksc7-key-for-encode.cer ([архив pksc7-key-for-encode.zip](/demo/pksc7-key-for-encode.zip)), с помощью которого нужно производить дешифровку наших запросов.
Please find attached the archive with a key (pksc7-key-for-encode.cer), which is needed for decryption of our checkOrder and Aviso requests.


Пример пакета pkcs#7 (сохраните его в файл checkOrderRequestPkcs7.file, для реализации теста, описанного ниже)
This is an example of pkcs#7 package (save it to a file checkOrderRequestPkcs7.file, for the implementation of the test, described below)

```
-----BEGIN PKCS7-----
MIAGCSqGSIb3DQEHAqCAMIACAQExCzAJBgUrDgMCGgUAMIAGCSqGSIb3DQEHAaCA
JIAEggPoPD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiID8+PGNo
ZWNrT3JkZXJSZXF1ZXN0IHNob3BTdW1DdXJyZW5jeVBheWNhc2g9IjEwNjQzIiBy
ZWJpbGxpbmdPbj0iZmFsc2UiIG9yZGVyU3VtQmFua1BheWNhc2g9IjEwMDMiIG9y
ZGVyTnVtYmVyPSIxMTQiIG9yZGVyU3VtQW1vdW50PSIxMzUxLjAwIiBvcmRlclN1
bUN1cnJlbmN5UGF5Y2FzaD0iMTA2NDMiIHNob3BBcnRpY2xlSWQ9IjE5Mzk1OCIg
cGF5bWVudFBheWVyQ29kZT0iNDEwMDMyMjA2MjI5MCIgY3VzdG9tZXJOdW1iZXI9
IjEiIHBheW1lbnRUeXBlPSJBQyIgcmVxdWVzdERhdGV0aW1lPSIyMDE1LTA5LTA5
VDE3OjU3OjIxLjczOSswMzowMCIgb3JkZXJDcmVhdGVkRGF0ZXRpbWU9IjIwMTUt
MDktMDlUMTc6NTc6MjEuNjQ2KzAzOjAwIiBpbnZvaWNlSWQ9IjIwMDAwMDA1ODM2
MzMiIHNob3BJZD0iNDcwNDEiIHNob3BTdW1BbW91bnQ9IjEzMDMuNzEiIHNob3BT
dW1CYW5rUGF5Y2FzaD0iMTAwMyI+PHBhcmFtIGtleT0iY3BzX2VwbERpc2FibGUi
IHZhbD0idHJ1ZSI+PC9wYXJhbT48cGFyYW0ga2V5PSJjZGRfZXhwX2RhdGUiIHZh
bD0iMDMxOCI+PC9wYXJhbT48cGFyYW0ga2V5PSJjZGRfcnJuIiB2YWw9Ijk5Mzg3
ODI0ODEyOCI+PC9wYXJhbT48cGFyYW0ga2V5PSJleHRlcm5hbF9pZCIgdmFsPSJk
ZXBvc2l0Ij48L3BhcmFtPjxwYXJhbSBrZXk9ImN1c3RvbURhdGUiIHZhbD0iMjAx
NS0wOS0wOSI+PC9wYXJhbT48cGFyYW0ga2V5PSJDb250cmFjdFRlbXBsYXRlSUQi
IHZhbD0iNTIzNDk3Ij48L3BhcmFtPjxwYXJhbSBrZXk9InVpZCIgdmFsPSIiPjwv
cGFyYW0+PHBhcmFtIGtleT0iZGVwb3NpdE51bWJlciIgdmFsPSI1ZDI3MWFjOWI2
ZTk2NGE2NWUwM2Q3MGM5ZjNlYjU4NmM2YTlmNTY2Ij48L3BhcmFtPjxwYXJhbSBr
ZXk9Im5zdF91bmlsYWJlbCIgdmFsPSIxZDgyNWM3YS0wMDA5LTUwMDAtODAwMC0w
MDAwMDExYjg1MjgiPjwvcGFyYW0+PHBhcmFtIGtleT0iU3VjY2Vzc1RlbXBsYQSC
A+h0ZSIgdmFsPSJ5bTJ4bWxzdWNjZXNzIj48L3BhcmFtPjxwYXJhbSBrZXk9ImNw
c191c2VyX2NvdW50cnlfY29kZSIgdmFsPSJSVSI+PC9wYXJhbT48cGFyYW0ga2V5
PSJjcHNfdXNlcl9pcCIgdmFsPSIxNzguNDUuMzEuMTc1Ij48L3BhcmFtPjxwYXJh
bSBrZXk9InNjaWQiIHZhbD0iNTI2MDcyIj48L3BhcmFtPjxwYXJhbSBrZXk9ImNw
c19yZWdpb25faWQiIHZhbD0iMjEzIj48L3BhcmFtPjxwYXJhbSBrZXk9Im1lcmNo
YW50X29yZGVyX2lkIiB2YWw9IjExNF8wOTA5MTUxNzU2NThfMDAwMDBfNDcwNDEi
PjwvcGFyYW0+PHBhcmFtIGtleT0iY3BzLXNvdXJjZSIgdmFsPSJkZWZhdWx0Ij48
L3BhcmFtPjxwYXJhbSBrZXk9ImN1c3RvbVRpbWUiIHZhbD0iMDY6NTgiPjwvcGFy
YW0+PHBhcmFtIGtleT0iRXJyb3JUZW1wbGF0ZSIgdmFsPSJ5bTJ4bWxlcnJvciI+
PC9wYXJhbT48cGFyYW0ga2V5PSJzdW1DdXJyZW5jeSIgdmFsPSIxMDY0MyI+PC9w
YXJhbT48cGFyYW0ga2V5PSJjZGRfcGFuX21hc2siIHZhbD0iNDI2ODAzfDU2MjQi
PjwvcGFyYW0+PHBhcmFtIGtleT0iY2RkX21vaSIgdmFsPSIxMTRfMDkwOTE1MTc1
NjU4XzAwMDAwXzQ3MDQxIj48L3BhcmFtPjxwYXJhbSBrZXk9InlhbmRleFBheW1l
bnRJZCIgdmFsPSIyNTcwMDE1OTk1MjUxIj48L3BhcmFtPjxwYXJhbSBrZXk9ImNk
ZF9lY2kiIHZhbD0iMDUiPjwvcGFyYW0+PHBhcmFtIGtleT0icmVxdWVzdGlkIiB2
YWw9IjMxMzkzMzMzMzYzNjM0NWYzODY2MzkzNjM1NjI2NDM0MzkzMDMxMzczNjM5
NjIzNzMzMzIzMDM5NjMzMDM2MzUzMTM2MzUzMDMyMzUzNjMwNjYzOTMzMzU2NjY0
NjI2MyI+PC9wYXJhbT48cGFyYW0ga2V5PSJjZGRfYXV0aF9jb2RlIiB2YWw9IjI0
MzQ2NCI+PC9wYXJhbT48cGFyYW0ga2V5PSJ5YW5kZXh1aWQiIHZhbD0iNjA3MjMw
ODMxNDM4MTY1OTM4Ij48L3BhcmFtPjxwYXJhbSBrZXk9ImNwc19jaGFuZ2VTdW0i
IHZhbD0iZmFsc2UiPjwvcGFyYW0+PHBhcmFtIGtleT0ic2tyX2VudiIgBCp2YWw9
ImRlc2t0b3AiPjwvcGFyYW0+PC9jaGVja09yZGVyUmVxdWVzdD4AAAAAAACggDCC
BNkwggRCoAMCAQICCnklOR4AAgAANZswDQYJKoZIhvcNAQEFBQAwSTELMAkGA1UE
BhMCUlUxGDAWBgNVBAoTD1BTIFlhbmRleC5Nb25leTEgMB4GA1UEAxMXWWFuZGV4
IE1vbmV5IElzc3VpbmcgQ0EwHhcNMTQwNDI5MDgwNzE4WhcNMTYwNDI5MDgxNzE4
WjCBqTELMAkGA1UEBhMCUlUxDzANBgNVBAgTBlJ1c3NpYTEZMBcGA1UEBxMQU2Fp
bnQtUGV0ZXJzYnVyZzEZMBcGA1UEChMQTktPIFlhbmRleC5Nb25leTELMAkGA1UE
CxMCSVQxFjAUBgNVBAMTDVBheW1lbnRDZW50ZXIxLjAsBgkqhkiG9w0BCQEWH3N5
-----BEGIN PKCS7-----
MIAGCSqGSIb3DQEHAqCAMIACAQExCzAJBgUrDgMCGgUAMIAGCSqGSIb3DQEHAaCA
JIAEggPoPD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiID8+PGNo
ZWNrT3JkZXJSZXF1ZXN0IHNob3BTdW1DdXJyZW5jeVBheWNhc2g9IjY0MyIgcmVi
aWxsaW5nT249ImZhbHNlIiBvcmRlclN1bUJhbmtQYXljYXNoPSIxMDAzIiBvcmRl
clN1bUFtb3VudD0iMTAwLjAwIiBvcmRlclN1bUN1cnJlbmN5UGF5Y2FzaD0iNjQz
IiBzaG9wQXJ0aWNsZUlkPSIxOTkwNTQiIHBheW1lbnRQYXllckNvZGU9IjQxMDAz
MjIwNjIyOTAiIHVuaWxhYmVsPSIyMDVhMThjNi0wMDA5LTUwMDAtODAwMC0wMDAw
MWUzMWZkZDgiIGN1c3RvbWVyTnVtYmVyPSJUZXN0X1lhbW9uZXkiIHBheW1lbnRU
eXBlPSJBQyIgcmVxdWVzdERhdGV0aW1lPSIyMDE3LTAzLTE0VDE3OjU4OjI2Ljc5
NiswMzowMCIgb3JkZXJDcmVhdGVkRGF0ZXRpbWU9IjIwMTctMDMtMTRUMTc6NTg6
MjYuNjk2KzAzOjAwIiBpbnZvaWNlSWQ9IjIwMDAwMDExMTIyOTgiIHNob3BJZD0i
NDk4MTMiIHNob3BTdW1BbW91bnQ9IjEwMC4wMCIgc2hvcFN1bUJhbmtQYXljYXNo
PSIxMDAzIj48cGFyYW0ga2V5PSJjcHNfcmVnaW9uX2lkIiB2YWw9IjQ3Ij48L3Bh
cmFtPjxwYXJhbSBrZXk9IkN1c3RBZGRyIiB2YWw9Ik1vc2NvdyI+PC9wYXJhbT48
cGFyYW0ga2V5PSJtZXJjaGFudF9vcmRlcl9pZCIgdmFsPSJUZXN0X1lhbW9uZXlf
MTQwMzE3MTc1ODE0XzAwMDAwXzQ5ODEzIj48L3BhcmFtPjxwYXJhbSBrZXk9ImNk
ZF9leHBfZGF0ZSIgdmFsPSIxMjE5Ij48L3BhcmFtPjxwYXJhbSBrZXk9Ik9yZGVy
RGV0YWlscyIgdmFsPSIiPjwvcGFyYW0+PHBhcmFtIGtleT0iY2RkX3JybiIgdmFs
PSI4MDQ2OTA0NzQ0MTEiPjwvcGFyYW0+PHBhcmFtIGtleT0iZXh0ZXJuYWxfaWQi
IHZhbD0iZGVwb3NpdCI+PC9wYXJhbT48cGFyYW0ga2V5PSJzdW1DdXJyZW5jeSIg
dmFsPSI2NDMiPjwvcGFyYW0+PHBhcmFtIGtleT0iY2RkX3Bhbl9tYXNrIiB2YWw9
IjQ0NDQ0NHw0NDQ4Ij48L3BhcmFtPjxwYXJhbSBrZXk9IkN1c3RFTWFpbCIgdgSC
AzhhbD0idGVzdC1mb3IteWFtb25leUB5YW5kZXgucnUiPjwvcGFyYW0+PHBhcmFt
IGtleT0iQ29udHJhY3RUZW1wbGF0ZUlEIiB2YWw9IjUyMzQ5NyI+PC9wYXJhbT48
cGFyYW0ga2V5PSJjZGRfbW9pIiB2YWw9IlRlc3RfWWFtb25leV8xNDAzMTcxNzU4
MTRfMDAwMDBfNDk4MTMiPjwvcGFyYW0+PHBhcmFtIGtleT0ieWFuZGV4UGF5bWVu
dElkIiB2YWw9IjI1NzAwODA3NzcyMTAiPjwvcGFyYW0+PHBhcmFtIGtleT0iQ3Vz
dE5hbWUiIHZhbD0idGVzdCAxMDAiPjwvcGFyYW0+PHBhcmFtIGtleT0iZGVwb3Np
dE51bWJlciIgdmFsPSJyODFtQWZORjg2LW11Z0JpZnhHaUpkQXM0ejRaLjAwMWYu
MjAxNzAzIj48L3BhcmFtPjxwYXJhbSBrZXk9ImNkZF9lY2kiIHZhbD0iMDUiPjwv
cGFyYW0+PHBhcmFtIGtleT0ibnN0X3VuaWxhYmVsIiB2YWw9IjIwNWExOGM2LTAw
MDktNTAwMC04MDAwLTAwMDAxZTMxZmRkOCI+PC9wYXJhbT48cGFyYW0ga2V5PSJj
cHNfdXNlcl9jb3VudHJ5X2NvZGUiIHZhbD0iUEwiPjwvcGFyYW0+PHBhcmFtIGtl
eT0iY2RkX3Jlc3BvbnNlX2NvZGUiIHZhbD0iMDAiPjwvcGFyYW0+PHBhcmFtIGtl
eT0ic2siIHZhbD0idTdmZGMzODBlYzU4NjQzMGM2MzhkOGFlZjU1MTFlY2I5Ij48
L3BhcmFtPjxwYXJhbSBrZXk9ImNwc191c2VyX2lwIiB2YWw9IjE5Mi4xNjguNTUu
MTYiPjwvcGFyYW0+PHBhcmFtIGtleT0iY2RkX2F1dGhfY29kZSIgdmFsPSI0NzI0
OTAiPjwvcGFyYW0+PHBhcmFtIGtleT0ibGFuZyIgdmFsPSJlbiI+PC9wYXJhbT48
cGFyYW0ga2V5PSJzY2lkIiB2YWw9IjUyNjMzMCI+PC9wYXJhbT48L2NoZWNrT3Jk
ZXJSZXF1ZXN0PgAAAAAAAKCAMIIE4jCCBEugAwIBAgITMgAARRsGU2BdsHID7QAC
AABFGzANBgkqhkiG9w0BAQUFADBJMQswCQYDVQQGEwJSVTEYMBYGA1UEChMPUFMg
WWFuZGV4Lk1vbmV5MSAwHgYDVQQDExdZYW5kZXggTW9uZXkgSXNzdWluZyBDQTAe
Fw0xNjA0MDgxMjI3NDRaFw0xODAxMTcxMzUyMTJaMIGpMQswCQYDVQQGEwJSVTEP
MA0GA1UECBMGUnVzc2lhMRkwFwYDVQQHExBTYWludC1QZXRlcnNidXJnMRkwFwYD
VQQKExBOS08gWWFuZGV4Lk1vbmV5MQswCQYDVQQLEwJJVDEWMBQGA1UEAxMNUGF5
bWVudENlbnRlcjEuMCwGCSqGSIb3DQEJARYfc3lzdGVtYWRtaW5pc3RyYXRvcnNA
eWFtb25leS5ydTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAM4aihL+
kf75LaQ5zdinbUkQuw8u1RxQQ6rbt2nIVo7y5C/Y9Obcp3vb/q4S3AkvfRqMvXTv
DB9GM5O+OtLzlu3kH82g+EsdS2JflPs32ndT8ZurWQNjoy+c9aFD5poyWq1yp6cT
Anyxr6txGq6uQbL0AU2u9ZeMdMdu4tWje+uMEg9Quyb1fNz5SIOICSeD9AdCfS6t
zSCZDL2ZXQ4+v908QL+ICZB2FYqPLyBXk+743BAAgn1VUPzTXNYehk+WIRJiG2kI
eWOOASjazGjjUJSo5f8x/yzQbuPbLPsNo7QiEoXNkwSsLTaeUsxlXpafeT3B4hVX
dFWErrGiTt7Ei48CAwEAAaOCAeEwggHdMB0GA1UdDgQWBBTBlHq6Yb13pHWHiJdh
/lt2x2qUrzAfBgNVHSMEGDAWgBTmLOeIVWnILDo9dmAW41baXjKS3DA1BgNVHR8E
LjAsMCqgKKAmhiRodHRwOi8vY3Jscy55YW1vbmV5LnJ1L2lzc3VpbmdjYS5jcmww
gc4GCCsGAQUFBwEBBIHBMIG+MIG7BggrBgEFBQcwAoaBrmxkYXA6Ly8vQ049WWFu
ZGV4JTIwTW9uZXklMjBJc3N1aW5nJTIwQ0EsQ049QUlBLENOPVB1YmxpYyUyMEtl
eSUyMFNlcnZpY2VzLENOPVNlcnZpY2VzLENOPUNvbmZpZ3VyYXRpb24sREM9eWFt
b25leSxEQz1ydT9jQUNlcnRpZmljYXRlP2Jhc2U/b2JqZWN0Q2xhc3M9Y2VydGlm
aWNhdGlvbkF1dGhvcml0eTALBgNVHQ8EBAMCB4AwPgYJKwYBBAGCNxUHBDEwLwYn
KwYBBAGCNxUIhNPQNYT06hSDyY0lh++3M4S2zAGBZ4eBn3mBhPNdAgFkAgEEMB0G
A1UdJQQWMBQGCCsGAQUFBwMEBggrBgEFBQcDAjAnBgkrBgEEAYI3FQoEGjAYMAoG
CCsGAQUFBwMEMAoGCCsGAQUFBwMCMA0GCSqGSIb3DQEBBQUAA4GBAGbZQ+XjGxQU
/CJLgxUzkgQXdwLFjHxAV7Q3NPhyFr2GUDUBpdk9pT67b9md4ZfyX+bV3DwHt2f1
Gf4ioqVFuI6n+yBEnJQuv1nJyGS+CMoyKTN3U6dCzwksGtIdwB0O9Vk2WA1/u1aL
4YyEW6bTjCoYhxML4I65/mVrNX8WWZoWAAAxggISMIICDgIBATBgMEkxCzAJBgNV
BAYTAlJVMRgwFgYDVQQKEw9QUyBZYW5kZXguTW9uZXkxIDAeBgNVBAMTF1lhbmRl
eCBNb25leSBJc3N1aW5nIENBAhMyAABFGwZTYF2wcgPtAAIAAEUbMAkGBSsOAwIa
BQCggYgwGAYJKoZIhvcNAQkDMQsGCSqGSIb3DQEHATAcBgkqhkiG9w0BCQUxDxcN
MTcwMzE0MTQ1ODI2WjAjBgkqhkiG9w0BCQQxFgQUYkyHXNwJ8haqPqY4XXTWG00M
KkMwKQYJKoZIhvcNAQk0MRwwGjAJBgUrDgMCGgUAoQ0GCSqGSIb3DQEBAQUAMA0G
CSqGSIb3DQEBAQUABIIBAL7B2LgTRH2WZnPyjjyLwATZpLk8YGKt+SsHbFKDErw1
C4o87bzO0nBTQRxLamiZHRhEJf1jQFHQqNdveqvSTXV2J+F3neHQMtx9cHCevE4S
op0V8JcEYhSgNavWWJottNefxK2ccYyuHW7UVkfSFv645DCGy/XaLoxrGoWkBs5/
zxuyuQNxZILy9Zh51PEVSC+3javohOlNGgH21PKpqxU7iDRDFRfRAq/0aUQALGaR
uH1QrlYgoNzJYD7ug1boWeJKQhwQepr2htpoI84085mHFUP3lVfwZMNXnoksmQi7
X7hIRSCaf31hA/vc1rfFF0akrWOqPpuSH37iZ4JsAFcAAAAAAAA=
-----END PKCS7-----
```

Этот же пакет в расшифрованном виде
The same package in a decrypted form

```
<?xml version="1.0" encoding="UTF-8" ?><checkOrderRequest
shopSumCurrencyPaycash="10643" rebillingOn="false"
orderSumBankPaycash="1003" orderNumber="114" orderSumAmount="1351.00"
orderSumCurrencyPaycash="10643" shopArticleId="193958"
paymentPayerCode="4100322062290" customerNumber="1" paymentType="AC"
requestDatetime="2015-09-09T17:57:21.739+03:00"
orderCreatedDatetime="2015-09-09T17:57:21.646+03:00"
invoiceId="2000000583633" shopId="47041" shopSumAmount="1303.71"
shopSumBankPaycash="1003"><param key="cps_eplDisable"
val="true"></param><param key="cdd_exp_date" val="0318"></param><param
key="cdd_rrn" val="993878248128"></param><param key="external_id"
val="deposit"></param><param key="customDate"
val="2015-09-09"></param><param key="ContractTemplateID"
val="523497"></param><param key="uid" val=""></param><param
key="depositNumber"
val="5d271ac9b6e964a65e03d70c9f3eb586c6a9f566"></param><param
key="nst_unilabel" val="1d825c7a-0009-5000-8000-0000011b8528"></param><param
key="SuccessTemplate" val="ym2xmlsuccess"></param><param
key="cps_user_country_code" val="RU"></param><param key="cps_user_ip"
val="178.45.31.175"></param><param key="scid" val="526072"></param><param
key="cps_region_id" val="213"></param><param key="merchant_order_id"
val="114_090915175658_00000_47041"></param><param key="cps-source"
val="default"></param><param key="customTime" val="06:58"></param><param
key="ErrorTemplate" val="ym2xmlerror"></param><param key="sumCurrency"
val="10643"></param><param key="cdd_pan_mask"
val="426803|5624"></param><param key="cdd_moi"
val="114_090915175658_00000_47041"></param><param key="yandexPaymentId"
val="2570015995251"></param><param key="cdd_eci" val="05"></param><param
key="requestid"
val="313933333636345f3866393635626434393031373639623733323039633036353136353
0323536306639333566646263"></param><param key="cdd_auth_code"
val="243464"></param><param key="yandexuid"
val="607230831438165938"></param><param key="cps_changeSum"
val="false"></param><param key="skr_env"
val="desktop"></param></checkOrderRequest>
```

Пример дешифровки
Example of decryption with openssl tool
```
openssl smime -verify -noverify -inform PEM -nointern -certfile ./pksc7-key-for-encode.cer -CAfile ./pksc7-key-for-encode.cer < checkOrderRequestPkcs7.file
```
